#include <unistd.h> 
#include <stdio.h> 
#include <sys/socket.h> 
#include <stdlib.h> 
#include <netinet/in.h> 
#include <string.h> 
#define PORT 8080 
#define LEVELS 13
char *password[12] = {"entendido\n","itba\n","M4GFKZ289aku\n","fk3wfLCm3QvS\n","too_easy\n",".RUN_ME\n","K5n2UFfpFMUN\n","BUmyYq5XxXGt\n","u^v\n","chin_chu_lan_cha\n","gdb_rules\n","normal\n"};


void desafio(int desafio) {
    printf("------------- DESAFIO -------------\n");
    switch(desafio) {
        case 0: printf("Bienvenido al CTF del TP3. Para continuar entre: entendido\\n\n");break;
        case 1: printf("The Wire S1E5 \n5295 888 6288\n");break;
        case 2: printf("https://ibb.co/tc0Hb6w\n");break;
        case 3: printf("EBADF...\n\nwrite: Bad file descriptor\n");break; //WRITE STRACE
        case 4: printf("respuesta = strings:277\n");break;
        case 5: printf(".data .bss .comment ? .shstrtab .symtab .strtab\n");break;
        case 6: printf("Work in progress\n");break; //FILTER
        case 7: printf("¿?\n\n\033[30mLa respuesta es BUmyYq5XxXGt\033[0m\n");break;
        case 8: printf("Latexme\nSi\n\mathrm{d}y = u^v{\cdot}(v'{\cdot}\ln{(u)}+v{\cdot}\frac{u'}{u})\nentonces\ny =\n");break;
        case 9: printf("quine\n");break;
        case 10: printf("b gdbme y encontrá el valor mágico\nENTER para reintentar.\n");break;
        case 11: printf("Me conoces\n\n-2.130460 -0.948829 0.871076 -0.405617 0.944424 0.384872 -0.670376 0.279788 -0.149310 0.226424 0.185993 1.242986 1.216158 0.040850 -0.672462 -0.285755 -1.722609 1.232837 -0.303173 1.043740 -0.532909 -0.369039 -0.511125 -0.085601 0.217462 -0.053226 0.019440 0.262315 0.811030 0.202753 -0.823689 0.117770 0.484928 -0.356122 0.153603 -1.160266 0.930688 -0.287605 -0.219713 -1.336978 -1.131466 -0.824978 1.467992 0.965372 0.406729 -1.703459 1.164983 -1.037773 1.652699 0.529376 1.998321 -0.884812 2.543375 -0.234421 1.696365 -0.244194 -0.900398 1.944356 -0.343242 -0.114369 0.541323 -0.094082 1.919265 0.033668 -0.139695 2.122018 -0.770328 -0.098126 -1.269245 -0.760327 -0.881274 0.408957 -0.031306 -1.514605 0.082189 0.228569 -1.732259 -0.584061 -0.540672 -0.045729 -0.147950 0.389430 0.186424 0.118535 0.171076 0.664135 0.631172 0.372419 -1.556103 0.255777 0.742276 -2.183811 1.404539 -0.235546 -0.661363 -0.014700 1.428187 0.289541 -3.228086 -1.614807 0.899589 -1.076056 0.184677 0.757557 -1.457321 -0.075028 -1.404497 -1.364774 0.029313 -0.241821 0.545166 -0.193762 1.552582 -0.198752 1.326054 0.653685 -0.997877 1.038441 0.618080 -1.752527 -1.692258 -1.924356 -0.328250 -2.203930 -0.193891 -0.720397 -0.070084 -0.289755 0.721614 1.910302 0.055677 1.613708 0.135397 0.113208 1.075209 0.247354 0.219846 -1.522621 -1.124047 0.373629 -0.511334 0.994376 -0.935006 0.465778 0.620467 -1.669314 -0.941542 -0.455380 -0.560100 0.076100 -1.500917 0.545127 1.073778 -1.225101 0.078529 0.826815 0.379245 -0.734849 0.460651 -0.268446 -0.501102 -0.296092 0.837590 -1.365988 1.044591 0.578576 -0.587576 0.118181 1.026928 0.430782 1.830716 0.705218 -0.151592 0.719161 0.199458 -0.429544 0.967017 -0.980231 -1.773083 -0.505749 1.103724 1.438561 0.936702 0.280244 0.278947 0.112084 -0.532745 0.108635 -1.148719 2.212790 0.487136 0.311163 1.952300 0.888756 0.433813 0.778295 1.806718 0.711908 0.706136 0.167248 0.402895 2.146832 -0.110081 1.080066 -0.404783 0.676324 -1.058921 -0.135427 -0.404677 0.606898 -1.201752 -0.106358 1.062097 -1.052942 -0.550873 -0.050106 -0.885509 0.593408 0.371800 -0.023949 -0.857933 0.345222 0.488312 -0.004105 -1.718762 -0.574663 0.126966 -1.443184 0.313357 2.024000 -0.680796 -0.610653 -1.412016 0.092430 0.698899 0.151980 1.456340 1.571106 0.197599 1.353902 -1.570124 0.037364 0.698573 0.564987 0.416979 0.392373 -0.516480 0.759754 -0.983395 1.302465 1.198140 -0.242567 1.964051 0.774870 0.421590 0.150608 -0.416965 0.483802 0.244062 -1.191329 2.191485 -0.354956 -0.746447 0.755294 -0.083666 0.756818 -0.111625 1.037674 0.587564 -0.097741 -0.260650 -0.442755 -0.611699 0.170500 0.160503 -0.390247 -0.558084 -1.408772 2.039537 0.128307 0.942409 -0.754385 0.189371 -1.173947 0.767073 -0.247533 0.066805 -0.377790 -1.059291 0.964129 -1.561951 0.868675 2.422575 1.201077 -0.056788 -0.590935 -0.624873 -0.376609 -0.206421 1.869289 -1.209461 -1.084233 0.702630 -0.002113 -0.161859 0.429899 0.824782 0.036134 0.025991 0.301433 -0.164886 0.000463 0.474524 1.529403 -1.138142 2.493972 -0.238073 -0.997368 1.144733 0.503304 0.407515 0.611830 -1.340810 0.201975 -0.399009 0.825373 -0.629662 -1.091276 0.734216 1.166873 -1.459121 -0.003146 -0.264234 -0.300112 0.130008 0.041074 0.100266 0.251171 -0.505404 -0.931634 -1.444461 -1.268125 0.785399 -0.053230 -0.567533 0.775643 -0.356360 1.280121 -0.369732 1.464820 -0.794871 0.652174 -0.423282 -0.836365 -1.249924 -1.511984 -0.268211 0.012007 0.800094 -2.477198 -0.362450 -0.536602 0.563980 0.303043 1.083719 -1.615091 0.968540 -1.011015 0.494187 1.030049 -1.206485 -1.540457 -0.579023 1.359434 -0.474899 0.953799 0.262905 0.441662 1.008338 0.722115 -1.743749 -0.719038 0.917370 -0.367338 -0.241452 -0.411061 -0.642036 0.682518 0.743179 0.475691 -0.851196 0.302134 -1.066859 1.729947 -0.973781 -0.437537 1.085009 0.666550 -1.937154 2.070124 0.115242 -1.593814 0.913443 -0.830963 -1.748184 -1.209117 -0.596814 -0.457618 -0.481251 -1.680996 2.105026 -0.343576 -1.768897 -0.527149 0.139236 -0.756984 -1.305738 1.527629 -0.044594 -0.975187 1.566627 1.810477 -1.545705 0.992024 -2.301367 0.594724 0.000896 -1.184760 -1.831828 0.480544 0.613196 0.450773 0.989421 1.177808 -0.343062 0.506822 0.283389 0.493672 1.523478 -0.798129 -0.827636 0.290001 0.865331 -1.239178 0.259386 0.725113 -1.282258 1.549861 -1.342289 1.660480 0.719695 -0.022401 -0.104130 0.682069 -0.670287 1.845624 -1.297640 -0.308569 0.492232 0.936982 1.148562 -0.024705 0.471944 -0.129739 0.005538 0.270167 0.530849 0.535058 0.619907 0.145898 0.237637 1.564513 0.521164 -0.083405 1.486571 -0.685541 0.506486 0.458627 1.233921 0.373747 0.056072 -0.666844 -0.423590 0.509478 -0.838666 0.122059 -0.232878 -1.121971 0.658758 0.401610 0.427148 0.106698 0.432288 -0.117226 1.112775 0.492518 0.917154 -0.017876 0.211441 0.459115 0.257248 -0.986931 -0.415083 -0.569220 0.399010 0.534866 0.709068 -0.058540 1.207394 -0.068378 0.424612 -0.340346 -0.448660 0.152522 0.428437 -1.484948 0.235042 -1.453517 -0.760188 -0.395411 0.186929 0.512374 0.407236 0.265145 0.793250 -1.110705 -0.568136 -0.500389 -0.407751 0.164715 0.530406 0.585229 1.243873 -1.335715 0.926100 -1.460013 1.301830 -0.560584 0.326373 -1.135632 0.677135 -0.163884 1.267518 -1.408607 -0.284594 -1.411348 0.434837 -0.575790 -0.227087 0.570915 0.240681 0.873304 0.715216 -0.602383 -0.039123 -0.538024 0.825766 -0.863883 -0.648010 -1.953512 -0.586469 1.794378 -1.648439 0.912361 0.921927 0.129625 -0.200337 -0.609208 1.228527 1.359479 1.828889 -0.802994 0.285534 -1.478923 0.038325 0.878552 0.197230 1.492240 -0.224923 0.434103 0.188177 0.311759 1.595389 -0.502556 -0.142953 0.476097 -0.862728 -1.103405 -0.982190 -1.255220 -0.059112 -0.538965 0.960779 0.557362 -0.376001 -0.984141 1.647928 -1.025214 0.331973 1.275456 0.604566 -0.215266 -1.368759 -0.113138 1.567581 1.427281 0.874041 0.547901 0.823784 2.674745 1.082837 -0.342060 -0.061739 1.595563 0.197238 0.357741 -0.368854 -0.931658 -1.355948 -1.438437 -0.826002 1.156972 0.742621 0.383956 1.482260 0.023117 -0.016396 1.202933 -2.472406 -0.503761 -0.584853 0.955369 0.253590 -1.177497 -0.255876 -0.321445 -1.417936 0.825785 -1.193029 -0.007896 0.516552 -0.971124 1.075458 -1.254439 0.304914 -0.063212 -0.601792 1.319922 -0.032231 -0.650050 -1.095859 -1.205192 -0.006329 -1.100909 -1.142656 -0.794249 0.061840 -0.192587 -0.755359 -0.191809 -0.318723 -0.950885 0.349929 -0.417077 0.365597 1.458419 -0.689564 0.132780 0.226406 -1.576327 -1.011473 0.416083 0.373994 1.131990 0.454736 -0.723474 1.175032 0.713783 -0.316081 -0.465805 1.146217 -0.304037 1.036322 -0.541837 -0.650574 1.566168 -0.184419 0.803829 0.294567 1.165017 -0.531777 0.473112 -0.201893 1.150060 0.931108 1.517753 -0.234727 -1.364914 -0.801241 1.860484 -0.415099 -0.441572 -0.826608 0.576189 -0.373209 0.752940 0.147867 2.482644 0.277960 -0.168798 1.110310 0.562482 0.530659 -0.952212 0.001792 -0.480749 -0.780010 -0.059059 -0.483107 -0.213978 0.525848 0.947923 -2.621045 1.397504 0.544103 0.608986 -1.571543 2.565452 -0.694177 0.219313 0.973720 -1.079140 -1.528067 1.664792 0.419098 0.720406 -0.127956 -0.636958 -0.302555 -1.231185 0.374817 -0.294761 -0.770675 -0.653236 0.785833 -0.960189 1.284168 0.031457 0.741119 -1.500836 1.704770 -1.134434 -0.783995 0.545929 0.053249 -0.808166 0.808032 1.277018 0.639364 0.248564 1.099262 1.180916 0.337299 1.144346 -0.795601 -1.387538 0.581144 2.934459 0.257944 -1.962875 0.067835 -0.215270 0.243119 -0.843573 0.219100 1.312260 -0.745776 -1.765578 -0.477944 0.127449 0.841193 0.518630 0.182240 0.035370 1.016870 -0.691047 -0.103947 0.132422 -0.601867 0.328918 0.573080 -0.013779 1.148063 -1.245663 0.211069 -0.534858 -0.847930 -0.351793 -1.681028 0.116317 -0.392253 -0.764752 -0.076412 1.078097 -0.756081 0.196997 -1.302084 0.232619 -0.225625 1.349773 2.293746 -0.565002 1.068239 -0.266404 -1.085587 1.456348 -0.403498 0.638025 -0.453933 -0.707106 -0.700869 -0.622658 0.168941 0.430894 -0.411249 1.472711 -0.252363 0.680790 -0.035346 -0.711238 1.493022 1.286367 0.228476 -0.524737 -1.512172 -1.724728 0.482154 -0.418529 -0.177272 0.008219 2.829023 -0.217617 -0.545097 -0.755639 -0.570114 -0.415652 0.231646 0.330452 -2.823110 -0.623259 -1.418365 0.730439 -1.439553 1.086045 -0.199649 0.571878 -1.540730 0.652622 -0.224096 -1.102432 0.788808 0.802321 1.372933 -0.560143 1.069635 -0.817497 -1.070945 -1.152258 0.324306 0.450348 0.564248 -0.848081 0.091571 1.363103 -0.446935 0.825440 0.487929 0.258892 -0.571266 -0.441610 0.662300 0.089886 -0.762463 -1.480503 0.554927 -0.657487 3.207123 0.183963 -1.337306 -0.243531 -1.094535 0.545496 -0.396231 1.481827 -0.179653 0.187453 -0.057265 -0.931684 0.668980 0.491389 0.409381 -0.300311 1.692560 -0.619192 0.211654 1.343668 0.423256 0.210409 0.462850 0.136677 -0.179490 0.341512 0.692586 0.271179 2.513730 -0.568203 1.404208 -1.162236 0.361196 -0.491423 0.346236 -0.894675 0.672054 0.815151 -1.442366 0.038472 -0.716953 -1.644069 -0.021204 -0.587035 0.587224 -0.990472 -0.045696 -2.298585 0.225133 -0.198122 0.765116 0.847186 0.982683 -1.411930 0.383313 0.573024 0.467898 -0.890350 2.108797 -2.614962 -0.420654 -1.943300 1.401967 -0.488281 0.372134 -1.386674 -0.484022 -0.925904 0.900708 1.681867 1.196543 0.193581 -0.604018 0.553048 0.081222 0.105209 -0.582113 -0.061720 1.172056 -1.027842 1.095071 0.054069 -1.130198 0.735158 -0.189628 -0.311155 0.808046 -0.211929 -1.363751 -1.147039 -0.313926 -0.422212 -0.147754 0.879295 -0.596942 -0.196364 -1.196446 0.303760 -0.183549 -1.632097 1.399565 0.418310 -0.095816 0.823010 -0.154966 -0.153292 -0.042086 -0.857418 -0.682099 0.688800 0.213804 -0.462903 0.529030 -1.328235\n");break;
        case 12: printf("Felicitaciones, finalizaron el juego.\n");
    }
    
}

int main(int argc, char const *argv[]) 
{ 
    int currentDes = 0;
    int server_fd, new_socket, valread; 
    struct sockaddr_in address; 
    int opt = 1; 
    int addrlen = sizeof(address); 
    char buffer[1024] = {0};
    size_t bufsize = 32;
    char *hello = "Hello from server"; 

    


    // Creating socket file descriptor 
    if ((server_fd = socket(AF_INET, SOCK_STREAM, 0)) == 0) 
    { 
        perror("socket failed"); 
        exit(EXIT_FAILURE); 
    } 
       
    // Forcefully attaching socket to the port 8080 
    if (setsockopt(server_fd, SOL_SOCKET, SO_REUSEPORT, 
                                                  &opt, sizeof(opt))) 
    { 
        perror("setsockopt"); 
        exit(EXIT_FAILURE); 
    } 
    address.sin_family = AF_INET; 
    address.sin_addr.s_addr = INADDR_ANY; 
    address.sin_port = htons( PORT ); 
       
    // Forcefully attaching socket to the port 8080 
    if (bind(server_fd, (struct sockaddr *)&address,  
                                 sizeof(address))<0) 
    { 
        perror("bind failed"); 
        exit(EXIT_FAILURE); 
    } 
    if (listen(server_fd, 3) < 0) 
    { 
        perror("listen"); 
        exit(EXIT_FAILURE); 
    } 
    if ((new_socket = accept(server_fd, (struct sockaddr *)&address,  
                       (socklen_t*)&addrlen))<0) 
    { 
        perror("accept"); 
        exit(EXIT_FAILURE); 
    } 
    

    while (currentDes < LEVELS) {
        system("clear");
        desafio(currentDes);
        fflush(stdout);
        valread = read( new_socket , buffer, 1024);
        buffer[valread] = 0;
        if (strcmp(buffer,password[currentDes]) == 0)
            currentDes++;
        else {
            if (buffer[0] == 0)
                break;
            printf("Respuesta incorrecta: %s\n", buffer);
            sleep(3);
        }
    }
    
    return 0; 
} 